# Lab 11

### Verifying and decoding secret
```
(devops) user@mbp-user k8s % kubectl create secret generic mypass --from-literal=password=password
secret/mypass created
(devops) user@mbp-user k8s % kubectl get secrets
NAME     TYPE     DATA   AGE
mypass   Opaque   1      1m31s
(devops) user@mbp-user k8s % kubectl describe secret mypass
Name:         mypass
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
password:  14 bytes
(devops) user@mbp-user k8s % kubectl get secret mypass -o jsonpath='{.data.password}' | base64 --decode
password%                                                                                                                                                              
```

### Helm secret configuration
```
(devops) user@mbp-user k8s % helm secrets install . -f secrets.yaml --generate-name
[helm-secrets] Decrypt: secrets.yaml
NAME: chart-4668301668
LAST DEPLOYED: Tue Nov 15 03:10:21 2022
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=web-app,app.kubernetes.io/instance=chart-1668466830" -o jsonpath="{.items[0].metadata.name}")
export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
echo "Visit http://127.0.0.1:8080 to use your application"
kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT

[helm-secrets] Removed: secrets.yaml.dec
(devops) user@mbp-user k8s % kubectl get po
NAME                                        READY   STATUS    RESTARTS   AGE
pod/java-app-helm-8c6de3744b-r6ksh   1/1     Running   0          49s
(devops) user@mbp-user k8s % kubectl exec pod/java-app-helm-8c6de3744b-r6ksh -- printenv | grep MY_PASS
MY_PASS=password
```

### Resource requests and limits for cpu and memory
```
(devops) user@mbp-user k8s % kubectl describe pod chart
Name:             pod/java-app-helm-8c6de3744b-r6ksh
Namespace:        default
Priority:         0
Service Account:  pod/java-app-helm-8c6de3744b-r6ksh
Node:             minikube/192.168.49.2
Start Time:       Tue Nov 15 03:10:21 2022 +0300
Labels:           app.kubernetes.io/instance=chart-1668466830
               app.kubernetes.io/name=web-app
               pod-template-hash=76cc5fd74f
Annotations:      <none>
Status:           Running
IP:               172.19.0.8
IPs:
IP:           172.19.0.8
Controlled By:  ReplicaSet/pod/java-app-helm-8c6de3744b-r6ksh
Containers:
web-app:
 Container ID:   docker://6326ad7d5aabbf47ec3fb78e22e380b7b0980a8de3d98f5ede2a90974cf7a081
 Image:          maxkoz777/moscow_time_java:latest
 Image ID:       docker-pullable://e2xen/devops-pythonapp@sha256:3951983f79f7d5c88b10bfefbf20d12b8fc731f8a95f3af267c3ade41353d19d
 Port:           80/TCP
 Host Port:      0/TCP
 State:          Running
   Started:      Tue Nov 15 03:10:21 2022 +0300
 Ready:          True
 Restart Count:  0
 Limits:
   cpu:     100m
   memory:  128Mi
 Requests:
   cpu:     50m
   memory:  128Mi
 Environment:
   MY_PASS:  <set to the key 'MY_PASS' in secret 'mypassword'>  Optional: false
 Mounts:
   /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-7gmn9 (ro)
Conditions:
Type              Status
Initialized       True
Ready             True
ContainersReady   True
PodScheduled      True
Volumes:
kube-api-access-7gmn9:
 Type:                    Projected (a volume that contains injected data from multiple sources)
 TokenExpirationSeconds:  3607
 ConfigMapName:           kube-root-ca.crt
 ConfigMapOptional:       <nil>
 DownwardAPI:             true
QoS Class:                   Burstable
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                          node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
Type    Reason     Age   From               Message
----    ------     ----  ----               -------
Normal  Scheduled  34s   default-scheduler  Successfully assigned pod/java-app-helm-8c6de3744b-r6ksh to minikube
Normal  Pulled     33s   kubelet            Container image "maxkoz777/moscow_time_java:latest" already present on machine
Normal  Created    33s   kubelet            Created container java-app-helm
Normal  Started    32s   kubelet            Started container java-app-helm
```